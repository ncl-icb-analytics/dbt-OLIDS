version: 2
models:
  - name: dim_person_demographics
    description: 'Current Person Demographics Dimension Table (Current State View)

      Provides current-state demographics derived from dim_person_demographics_historical.
      Contains only the most recent demographic information for each person.

      Key Features:

      • Current-state snapshot (is_current_period = TRUE)

      • Derived from historical SCD2 table for consistency

      • One row per person with complete demographic information

      Data Quality Filtering:

      • EXCLUDES persons without practice registration (inherited from historical table)

      • Ensures all records have valid GP practice information

      • Contains only persons with recorded birth dates and practice registration'
    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - not_null
          - unique
      
      - name: birth_date_approx
        description: Approximate date of birth (mid-month)
        tests:
          - not_null
      
      - name: birth_date_approx_end_of_month
        description: 'Approximate date of birth using the last day of the recorded birth month, passed through from dim_person_age. Complements birth_date_approx (mid-month).'
      
      - name: age
        description: Current age in years calculated from birth date
        tests:
          - not_null  # Always present since based on birth_date_approx
      
      - name: age_at_least
        description: 'Minimum possible age in full years, derived from dim_person_age using DOB as the last day of the birth month.'
      
      - name: sex
        description: Person's sex (Male, Female, or Unknown)
        tests:
          - not_null  # Always populated even if Unknown
          - accepted_values:
              arguments:
                values: ['Male', 'Female', 'Unknown']
      
      - name: practice_code
        description: GP practice code from registration (current or most recent historical)
        tests:
          - not_null  # Required - persons without practice info are excluded
