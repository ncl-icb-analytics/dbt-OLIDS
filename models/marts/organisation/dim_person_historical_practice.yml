version: 2
models:
- name: dim_person_historical_practice
  description: 'Mart: Person Historical Practice Dimension - Complete practice registration history for each person.


    Population Scope:

    • All persons with current and historical practice registrations

    • One row per person per practice registration period

    • Complete timeline of practice registration history and patient mobility


    Key Features:

    • Tracks all practice registrations with accurate start and end dates

    • Includes practice transition information and registration sequence analysis

    • Supports longitudinal care continuity and patient journey analytics'

  columns:
  - name: person_id
    description: Unique person identifier

    tests:
    - not_null
  - name: practice_id
    description: Practice identifier

    tests:
    - not_null
  - name: practice_code
    description: Practice ODS code

    tests:
    - not_null
  - name: practice_name
    description: Practice name

    tests:
    - not_null
  - name: registration_start_date
    description: Start date of registration at this practice

    tests:
    - not_null
  - name: registration_end_date
    description: End date of registration (NULL if current)
  - name: registration_duration_days
    description: Duration of registration in days (NULL for active registrations)

    tests:
    - dbt_utils.accepted_range:
        min_value: 0
        max_value: 50000
        where: "registration_end_date IS NOT NULL"
  - name: registration_sequence
    description: Sequence number of this registration for the person (1 = first practice)

    tests:
    - not_null
    - dbt_utils.accepted_range:
        min_value: 1
        max_value: 50
