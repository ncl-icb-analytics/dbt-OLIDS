version: 2
models:
- name: fct_person_atrial_fibrillation_register
  description: 'QOF Atrial Fibrillation Register - Patients with active atrial fibrillation diagnosis.


    Key Inclusion Criteria:


    • Active AF diagnosis: Latest AFIB_COD > latest AFIBRES_COD OR no resolution recorded

    • No age restrictions

    • No medication validation requirements

    • Excludes resolved AF cases


    Purpose: QOF register for AF management, stroke prevention, and anticoagulation monitoring.'

  columns:
  - name: person_id
    description: Unique person identifier across the HEI system

    tests:
    - not_null
    - unique
  - name: is_on_register
    description: QOF register inclusion flag - TRUE for all persons in this table

    tests:
    - not_null
    - accepted_values:

        values:
        - true
  - name: earliest_diagnosis_date
    description: Date of first recorded atrial fibrillation diagnosis code (AFIB_COD)

    tests:
    - dbt_utils.not_accepted_values:

        values:
        - '1900-01-01'
  - name: latest_diagnosis_date
    description: Date of most recent atrial fibrillation diagnosis code (AFIB_COD)

    tests:
    - not_null
  - name: latest_af_resolved_date
    description: Date of most recent AF resolved code (AFIBRES_COD) - NULL if never resolved
  - name: nafld_diagnosis_codes
    description: Array of all AF diagnosis and resolution concept codes recorded for this person
  - name: nafld_diagnosis_displays
    description: Array of all AF diagnosis and resolution concept display terms
  - name: all_source_cluster_ids
    description: Array of source cluster IDs (AFIB_COD, AFIBRES_COD) for traceability
  - name: meets_age_criteria
    description: 'Boolean flag: TRUE (no age restrictions for AF register)'

    tests:
    - not_null
    - accepted_values:

        values:
        - true
  - name: has_active_diagnosis
    description: 'Boolean flag: TRUE if latest diagnosis > latest resolution (or no resolution)'

    tests:
    - not_null
    - accepted_values:

        values:
        - true
