version: 2
models:
  - name: fct_person_chd_register
    description: |
      **CHD Register - QOF Cardiovascular Disease Quality Measures**

      Fact table for CHD register following a simple register pattern. All patients with any CHD diagnosis are included on the register as CHD is considered a permanent condition.

      **Simple Register Business Logic:**
      - Presence of CHD diagnosis = on register (lifelong condition)
      - No resolution codes (CHD is permanent)
      - No age restrictions
      - Important for secondary prevention monitoring

      **QOF Context:**
      Used for cardiovascular disease secondary prevention quality measures including:
      - Medication monitoring (statins, antiplatelets, ACE inhibitors)
      - Blood pressure management targets
      - Cholesterol management
      - Lifestyle intervention tracking
    columns:
      - name: person_id
        description: Unique person identifier
        tests:
          - not_null
          - relationships:
              to: ref('dim_person')
              field: person_id
      - name: is_on_register
        description: 'Register flag: has CHD diagnosis (always TRUE for this table)'
        tests:
          - not_null
          - accepted_values:
              values:
                - true
      - name: earliest_diagnosis_date
        description: Date of most recent CHD diagnosis
        tests:
          - not_null
          # Assuming test_no_future_dates is a custom test
          - test_no_future_dates
      - name: all_chd_concept_codes
        description: Array of all distinct CHD concept codes for this person
        tests:
          - not_null
      - name: all_chd_concept_displays
        description: Array of all distinct CHD concept display terms for this person
        tests:
          - not_null
