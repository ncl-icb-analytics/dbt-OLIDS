version: 2
models:
- name: fct_person_learning_disability_register
  description: "**Learning Disability Register - QOF Quality Measures**\n\nPattern 1: Simple Register with age filter.\n\n\
    QOF Business Logic:\n- Learning disability diagnosis (LD_DIAGNOSIS_COD) for age \u226514 years\n- No resolution codes\
    \ (LD is permanent condition)\n- Age restriction: patients must be 14+ years\n- Includes ALL persons (active, inactive,\
    \ deceased) for comprehensive reporting\n\nQOF Context:\nUsed for learning disability quality measures including:\n- Learning\
    \ disability care pathway monitoring\n- Health equity assessment and improvement\n- Special needs service coordination\n\
    - Annual health checks\n\nMatches legacy fct_person_dx_ld business logic and field structure.\n"
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
    - relationships:
        to: ref('dim_person')
        field: person_id
#   - name: age
#     description: Current age of person in years
#     tests:
#     - dbt_utils.accepted_range:
#         min_value: 14
#         max_value: 120
  - name: is_on_register
    description: 'Register flag: has LD diagnosis aged 14+ (always TRUE for this table)'
    tests:
    - not_null
    - accepted_values:
        values:
        - true
  - name: earliest_diagnosis_date
    description: Date of most recent learning disability diagnosis
    tests:
    - not_null
    - test_no_future_dates
  - name: all_ld_concept_codes
    description: Array of all distinct learning disability concept codes for this person
    tests:
    - not_null
  - name: all_ld_concept_displays
    description: Array of all distinct learning disability concept display terms for this person
    tests:
    - not_null
