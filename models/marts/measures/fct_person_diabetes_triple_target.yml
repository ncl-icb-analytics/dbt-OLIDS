version: 2
models:
- name: fct_person_diabetes_triple_target
  description: 'Mart: Diabetes Triple Target Achievement - Comprehensive diabetes control assessment for cardiovascular risk reduction.


    Business Purpose:

    • Support QOF reporting for diabetes triple target achievement indicators

    • Enable clinical teams to identify patients requiring comprehensive diabetes management review

    • Provide population health analytics for diabetes cardiovascular risk management programmes

    • Support business intelligence reporting on diabetes care quality and holistic management


    Data Granularity:

    • One row per person on diabetes register

    • Includes achievement status for HbA1c, blood pressure, and cholesterol targets

    • Current assessment of comprehensive diabetes control and cardiovascular risk management


    Key Features:

    • Tracks HbA1c ≤58 mmol/mol, BP <130/80 mmHg, and cholesterol <5 mmol/L targets

    • Calculates overall triple target achievement for holistic diabetes management

    • Supports clinical decision-making for cardiovascular risk reduction

    • Enables population health management and diabetes care optimisation'

  columns:
  - name: person_id
    description: Unique person identifier

    tests:
    - not_null
    - relationships:
        to: ref('int_diabetes_diagnoses_all')
        field: person_id
  - name: diabetes_type
    description: Type of diabetes (Type 1, Type 2, or determined type)

    tests:
    - accepted_values:

        values:
        - Type 1
        - Type 2
        - Unknown
  - name: latest_hba1c_date
    description: Date of most recent HbA1c test

    tests:
    - test_no_future_dates
  - name: latest_hba1c_value
    description: Most recent HbA1c result value

    tests:
    - dbt_utils.accepted_range:
        min_value: 10
        max_value: 300
  - name: hba1c_type
    description: 'HbA1c measurement type: ''IFCC'' (mmol/mol) or ''DCCT'' (%)'

    tests:

    - accepted_values:

        values:

        - IFCC

        - DCCT
  - name: latest_bp_date
    description: Date of most recent blood pressure reading

    tests:

    - test_no_future_dates

  - name: latest_systolic
    description: Most recent systolic blood pressure (mmHg)

    tests:

    - dbt_utils.accepted_range:
        min_value: 40
        max_value: 350
  - name: latest_diastolic
    description: Most recent diastolic blood pressure (mmHg)

    tests:

    - dbt_utils.accepted_range:
        min_value: 20
        max_value: 200
  - name: latest_chol_date
    description: Date of most recent total cholesterol test

    tests:

    - test_no_future_dates

  - name: latest_chol_value
    description: Most recent total cholesterol level (mmol/L)

    tests:

    - dbt_utils.accepted_range:
        min_value: 1
        max_value: 15
  - name: hba1c_in_target_range
    description: TRUE if latest HbA1c is in target range (< 58 mmol/mol or < 7.5%)

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: bp_in_target_range
    description: TRUE if latest BP is in target range (Systolic < 140 AND Diastolic < 80)

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: cholesterol_in_target_range
    description: TRUE if latest cholesterol is in target range (< 5 mmol/L)

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: all_three_targets_met
    description: TRUE if all three targets (HbA1c, BP, cholesterol) are achieved

    tests:

    - not_null

    - accepted_values:

        values:

        - true

        - false

  - name: hba1c_measured_in_last_12m
    description: TRUE if HbA1c measured within last 12 months

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: bp_measured_in_last_12m
    description: TRUE if blood pressure measured within last 12 months

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: cholesterol_measured_in_last_12m
    description: TRUE if cholesterol measured within last 12 months

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: hba1c_recent_but_out_of_range
    description: TRUE if HbA1c measured recently (last 12m) but not in target range

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: bp_recent_but_out_of_range
    description: TRUE if BP measured recently (last 12m) but not in target range

    tests:

    - accepted_values:

        values:

        - true

        - false

  - name: cholesterol_recent_but_out_of_range
    description: TRUE if cholesterol measured recently (last 12m) but not in target range

    tests:

    - accepted_values:

        values:

        - true

        - false
