version: 2
models:
- name: dim_valproate_db_scope
  description: 'Dashboard scope table - every row should be included in the valproate monitoring dashboard.

    Business Logic:
    • Joins child-bearing age cohort (non-male, 0-55 years) with recent valproate prescriptions (last 6 months)
    • One row per person with their most recent valproate prescription details
    • Only includes patients meeting both criteria: correct age/gender AND recent valproate therapy'
  columns:
  - name: person_id
    description: Unique identifier for a person
    tests:
    - not_null
    - unique
  - name: age
    description: Age of the person (0-55 for this cohort)
  - name: sex
    description: Sex of the person (non-'Male')
  - name: is_child_bearing_age_0_55
    description: TRUE for all rows, indicating age 0-55 and non-male
  - name: most_recent_valproate_order_date
    description: Date of the most recent Valproate order in the last 6 months
  - name: valproate_medication_order_id
    description: Identifier for the most recent Valproate medication order
  - name: valproate_order_medication_name
    description: Name of the medication on the most recent Valproate order
  - name: valproate_product_term
    description: Specific Valproate product term from the recent order
  - name: valproate_recent_order_count
    description: Total count of Valproate orders for this person in the last 6 months
  - name: valproate_order_dose
    description: Dosage information from the most recent Valproate order
  - name: valproate_order_quantity_value
    description: Numeric quantity from the most recent Valproate order
  - name: valproate_order_quantity_unit
    description: Unit for the quantity on the most recent Valproate order
  - name: valproate_order_duration_days
    description: Duration in days of the most recent Valproate prescription
