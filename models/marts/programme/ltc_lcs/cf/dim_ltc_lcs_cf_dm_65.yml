version: 2

models:
  - name: dim_ltc_lcs_cf_dm_65
    description: "Intermediate model for LTC/LCS case finding DM_65. Identifies patients with moderate-high BMI based on ethnicity who require diabetes screening due to lack of recent HbA1c testing."
    
    columns:
      - name: person_id
        description: "Unique identifier for the person"
        tests:
          - not_null
          - unique

      - name: age
        description: "Age of the patient (17+)"
        tests:
          - not_null

      - name: has_moderate_high_bmi
        description: "Boolean flag indicating if person has moderate-high BMI based on ethnicity thresholds"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_bame
        description: "Boolean flag indicating if person is from BAME ethnicity"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: latest_bmi_date
        description: "Date of most recent BMI measurement"
        tests:
          - not_null

      - name: latest_bmi_value
        description: "Most recent BMI value (27.5-32.5 for BAME, 30-35 for non-BAME)"
        tests:
          - not_null

      - name: latest_hba1c_date
        description: "Date of most recent HbA1c reading (should be null for this cohort)"

      - name: latest_hba1c_value
        description: "Most recent HbA1c value (should be null for this cohort)"

      - name: all_bmi_codes
        description: "Array of all BMI concept codes for the patient"

      - name: all_bmi_displays
        description: "Array of all BMI concept display terms for the patient" 