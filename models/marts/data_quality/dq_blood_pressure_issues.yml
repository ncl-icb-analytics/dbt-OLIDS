models:
- name: dq_blood_pressure_issues
  tests:
  - cluster_ids_exist:
      cluster_ids: ABPM_COD, BP_COD, DIABP_COD, HOMEAMBBP_COD, HOMEBP_COD, SYSBP_COD
  description: 'Mart: Blood Pressure Data Quality Issues - Business data quality monitoring tool for blood pressure measurements.


    Business Purpose:

    • Support clinical governance teams in monitoring data quality and identifying problematic readings

    • Enable data stewards to investigate and resolve blood pressure recording issues

    • Provide quality assurance reporting for clinical audit and business intelligence teams

    • Support population health analytics by identifying patients with unreliable BP data


    Data Granularity:

    • One row per person per date with blood pressure data quality issues


    • Includes all problematic readings: out-of-range values, orphaned readings, coding ambiguity, missing dates

    • Covers current patients with BP measurement quality concerns


    Key Features:

    • Identifies systolic values outside clinical range (< 40 or > 350 mmHg)

    • Detects diastolic values outside clinical range (< 20 or > 200 mmHg)

    • Flags orphaned readings (systolic without diastolic or vice versa)

    • Highlights coding ambiguity issues in source data systems'

  columns:
  - name: person_id
    description: Unique person identifier

    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of BP measurement (can be NULL for date missing issues)
  - name: systolic_value_original
    description: Original systolic BP value before range filtering (40-350 mmHg)
  - name: diastolic_value_original
    description: Original diastolic BP value before range filtering (20-200 mmHg)
  - name: result_unit_display
    description: BP measurement unit (typically mmHg)
  - name: all_concept_codes
    description: Array of all SNOMED concept codes contributing to this BP event
  - name: all_concept_displays
    description: Array of all concept display terms for traceability
  - name: all_source_cluster_ids
    description: Array of source cluster IDs (BP_COD, SYSBP_COD, DIABP_COD, etc.)
  - name: is_sbp_out_of_range
    description: TRUE if systolic BP is <40 or >350 mmHg

    tests:
    - accepted_values:

        values:
        - true
        - false
  - name: is_dbp_out_of_range
    description: TRUE if diastolic BP is <20 or >200 mmHg

    tests:
    - accepted_values:

        values:
        - true
        - false
  - name: is_coding_ambiguous
    description: TRUE if BP_COD used without specific SYSBP_COD/DIABP_COD codes

    tests:
    - accepted_values:

        values:
        - true
        - false
  - name: is_orphaned_reading
    description: TRUE if only SBP or DBP present (missing paired reading)

    tests:
    - accepted_values:

        values:
        - true
        - false
  - name: is_date_missing
    description: TRUE if clinical_effective_date is NULL

    tests:
    - accepted_values:

        values:
        - true
        - false
