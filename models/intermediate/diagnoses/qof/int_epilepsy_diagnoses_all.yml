version: 2
models:
- name: int_epilepsy_diagnoses_all
  tests:
  - cluster_ids_exist:
      cluster_ids: EPIL_COD, EPILRES_COD
  description: "All epilepsy diagnosis observations from clinical records using QOF cluster IDs.\nProvides comprehensive data\
    \ collection for epilepsy register and neurological management.\n\nQOF Cluster IDs Used:\n- EPIL_COD: Epilepsy diagnoses\n\
    - EPILRES_COD: Epilepsy resolved/remission codes\n\nClinical Purpose:\n- QOF epilepsy register data collection (aged 18+,\
    \ active epilepsy diagnosis + recent medication)\n- Epilepsy care pathway monitoring\n- Seizure management support\n-\
    \ Medication therapy integration for neurological conditions\n\nKey QOF Requirements:\n- Register inclusion: Age \u2265\
    18, active epilepsy diagnosis (latest EPIL_COD > latest EPILRES_COD)\n- AND recent epilepsy medication order (within last\
    \ 6 months)\n- Neurological condition with specific medication monitoring requirements\n\nNote: This model provides diagnosis\
    \ codes only. Medication integration is handled \nin the corresponding fact table which joins to intermediate_epilepsy_orders_6m.\n\
    \nIncludes ALL persons following intermediate layer principles.\nUse as input for fct_person_epilepsy_register.sql which\
    \ applies QOF business rules and medication integration.\n"
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier
    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the epilepsy diagnosis observation
    tests:
    - not_null
  - name: concept_code
    description: SNOMED concept code for epilepsy diagnosis
    tests:
    - not_null
  - name: concept_display
    description: Description of the epilepsy diagnosis code
    tests:
    - not_null
  - name: source_cluster_id
    description: QOF cluster ID (EPIL_COD, EPILRES_COD)
    tests:
    - not_null
  - name: is_epilepsy_diagnosis_code
    description: Flag indicating epilepsy diagnosis (EPIL_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_epilepsy_resolved_code
    description: Flag indicating epilepsy resolved/remission (EPILRES_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: earliest_epilepsy_date
    description: Earliest epilepsy diagnosis date for this person
  - name: latest_epilepsy_date
    description: Latest epilepsy diagnosis date for this person
  - name: earliest_resolved_date
    description: Earliest epilepsy resolved date for this person
  - name: latest_resolved_date
    description: Latest epilepsy resolved date for this person
  - name: epilepsy_observation_type
    description: Classification of this specific observation (Epilepsy Diagnosis, Epilepsy Resolved, Unknown)
    tests:
    - not_null
    - accepted_values:
        values:
        - Epilepsy Diagnosis
        - Epilepsy Resolved
        - Unknown
  - name: all_epilepsy_concept_codes
    description: Array of all epilepsy diagnosis concept codes for this person
  - name: all_epilepsy_concept_displays
    description: Array of all epilepsy diagnosis concept displays for this person
  - name: all_resolved_concept_codes
    description: Array of all epilepsy resolved concept codes for this person
  - name: all_resolved_concept_displays
    description: Array of all epilepsy resolved concept displays for this person
