version: 2
models:
- name: int_learning_disability_diagnoses_all
  tests:
  - cluster_ids_exist:
      cluster_ids: LDRES_COD, LD_COD
  description: "All learning disability diagnosis observations from clinical records using QOF cluster ID.\nProvides comprehensive\
    \ data collection for learning disability register and special needs service planning.\n\nQOF Cluster IDs Used:\n- LD_DIAGNOSIS_COD:\
    \ Learning disability diagnoses\n\nClinical Purpose:\n- QOF learning disability register data collection (age \u226514)\n\
    - Learning disability care pathway monitoring\n- Special needs service planning\n- Health equity monitoring\n\nKey QOF\
    \ Requirements:\n- Register inclusion: Age \u226514 and presence of learning disability diagnosis (LD_DIAGNOSIS_COD)\n\
    - No resolution codes - learning disability is considered permanent condition\n- Age threshold of 14 years for register\
    \ inclusion\n- No upper age limit\n\nNote: Learning disability does not have resolved codes as it is considered a permanent\
    \ condition.\nThe register is based purely on the presence of diagnostic codes and age criteria.\n\nIncludes ALL persons\
    \ following intermediate layer principles.\nUse as input for fct_person_learning_disability_register.sql which applies\
    \ QOF business rules and age filtering.\n"
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier
    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the learning disability diagnosis observation
    tests:
    - not_null
  - name: concept_code
    description: SNOMED concept code for learning disability diagnosis
    tests:
    - not_null
  - name: concept_display
    description: Description of the learning disability diagnosis code
    tests:
    - not_null
  - name: source_cluster_id
    description: QOF cluster ID (LD_COD, LDRES_COD)
    tests:
    - not_null
  - name: is_learning_disability_diagnosis_code
    description: Flag indicating learning disability diagnosis (LD_DIAGNOSIS_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: earliest_ld_diagnosis_date
    description: Earliest learning disability diagnosis date for this person
  - name: latest_ld_diagnosis_date
    description: Latest learning disability diagnosis date for this person
  - name: all_ld_concept_codes
    description: Array of all learning disability diagnosis concept codes for this person
  - name: all_ld_concept_displays
    description: Array of all learning disability diagnosis concept displays for this person
