version: 2
models:
- name: int_heart_failure_diagnoses_all
  tests:
  - cluster_ids_exist:
      cluster_ids: HFLVSD_COD, HFRES_COD, HF_COD, REDEJCFRAC_COD
  description: 'Intermediate: Heart Failure Diagnoses All - Complete history of all heart failure diagnosis and resolution observations for QOF register management.


    Clinical Purpose:

    • QOF heart failure register data collection and monitoring

    • Heart failure type classification and cardiac function assessment

    • HFrEF vs HFpEF identification and treatment pathway coordination

    • Resolution status tracking for improved cardiac outcomes


    Data Granularity:

    • One row per heart failure diagnosis or resolution observation

    • Uses HF_COD, HFRES_COD, HFLVSD_COD, and REDEJCFRAC_COD clusters

    • Includes all patients regardless of status for comprehensive QOF reporting


    Key Features:

    • Heart failure type classification with ejection fraction considerations

    • Left ventricular systolic dysfunction and reduced ejection fraction tracking

    • Critical for cardiac care pathway optimisation

    • Essential input for heart failure quality improvement initiatives'
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier
    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the heart failure diagnosis observation
    tests:
    - not_null
  - name: concept_code
    description: SNOMED concept code for heart failure diagnosis
    tests:
    - not_null
  - name: concept_display
    description: Description of the heart failure diagnosis code
    tests:
    - not_null
  - name: source_cluster_id
    description: QOF cluster ID (HF_COD, HFRES_COD, HFLVSD_COD, REDEJCFRAC_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - HF_COD
        - HFRES_COD
        - HFLVSD_COD
        - REDEJCFRAC_COD
  - name: is_heart_failure_diagnosis_code
    description: Flag indicating general heart failure diagnosis (HF_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_heart_failure_resolved_code
    description: Flag indicating heart failure resolved/remission (HFRES_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_hf_lvsd_code
    description: Flag indicating HF with left ventricular systolic dysfunction (HFLVSD_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_reduced_ef_code
    description: Flag indicating reduced ejection fraction (REDEJCFRAC_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: earliest_hf_date
    description: Earliest heart failure diagnosis date for this person
  - name: latest_hf_date
    description: Latest heart failure diagnosis date for this person
  - name: earliest_hf_lvsd_date
    description: Earliest HF with LVSD diagnosis date for this person
  - name: latest_hf_lvsd_date
    description: Latest HF with LVSD diagnosis date for this person
  - name: earliest_reduced_ef_date
    description: Earliest reduced ejection fraction diagnosis date for this person
  - name: latest_reduced_ef_date
    description: Latest reduced ejection fraction diagnosis date for this person
  - name: earliest_resolved_date
    description: Earliest heart failure resolved date for this person
  - name: latest_resolved_date
    description: Latest heart failure resolved date for this person
  - name: heart_failure_observation_type
    description: Classification of this specific observation
    tests:
    - not_null
    - accepted_values:
        values:
        - Heart Failure Diagnosis
        - HF with LVSD
        - Reduced Ejection Fraction
        - Heart Failure Resolved
        - Unknown
  - name: all_hf_concept_codes
    description: Array of all heart failure diagnosis concept codes for this person
  - name: all_hf_concept_displays
    description: Array of all heart failure diagnosis concept displays for this person
  - name: all_hf_lvsd_concept_codes
    description: Array of all HF with LVSD concept codes for this person
  - name: all_reduced_ef_concept_codes
    description: Array of all reduced ejection fraction concept codes for this person
  - name: all_resolved_concept_codes
    description: Array of all heart failure resolved concept codes for this person
