version: 2
models:
- name: int_arb_medications_all
  description: 'Intermediate: ARB Medication Orders - All recorded angiotensin receptor blocker prescriptions.


    Clinical Purpose:

    • Tracks ARB therapy for cardiovascular and renal protection

    • Supports blood pressure management and medication review processes

    • Enables analysis of ARB usage as alternative to ACE inhibitors


    Data Granularity:

    • One row per medication order

    • Includes all patients regardless of status (active/inactive/deceased)

    • Historical data maintained for longitudinal analysis


    Key Features:

    • Classification by specific ARB type (losartan, valsartan, candesartan, etc.)

    • Evidence-based medication flags for cardiovascular disease management

    • Clinical trial evidence mapping (LIFE, Val-HeFT, CHARM, ONTARGET trials)

    • Recency indicators for therapy monitoring (3m, 6m, 12m)'
  columns:
  - name: person_id
    description: Unique person identifier across the HEI system
    tests:
    - not_null
  - name: medication_order_id
    description: Unique identifier for the medication order record
    tests:
    - not_null
    - unique
  - name: arb_type
    description: Specific ARB medication type
    tests:
    - not_null
    - accepted_values:
        values:
        - AZILSARTAN
        - CANDESARTAN
        - EPROSARTAN
        - IRBESARTAN
        - LOSARTAN
        - OLMESARTAN
        - TELMISARTAN
        - VALSARTAN
        - OTHER_ARB
  - name: is_evidence_based_cvd
    description: Boolean flag indicating evidence-based ARB for cardiovascular disease (losartan, valsartan, candesartan, telmisartan)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_losartan
    description: Boolean flag indicating losartan use (LIFE trial evidence)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_valsartan
    description: Boolean flag indicating valsartan use (Val-HeFT trial evidence)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_candesartan
    description: Boolean flag indicating candesartan use (CHARM trial evidence)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_irbesartan
    description: Boolean flag indicating irbesartan use
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_telmisartan
    description: Boolean flag indicating telmisartan use (ONTARGET trial evidence)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - person_id
      - medication_order_id
  - bnf_codes_exist:
      bnf_codes: '02050502'
