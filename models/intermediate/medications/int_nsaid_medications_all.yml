version: 2

models:
  - name: int_nsaid_medications_all
    description: |
      All NSAID (Non-Steroidal Anti-Inflammatory Drug) medication orders for pain and inflammation.
      Uses BNF classification (10.1.1) for NSAIDs and (10.3.2) for topical NSAIDs.
      Includes ALL persons (active, inactive, deceased) following intermediate layer principles.

      Clinical Purpose:
      - Pain management (acute and chronic)
      - Anti-inflammatory treatment
      - Fever reduction (antipyretic)
      - Cardiovascular risk assessment and monitoring

      Key Features:
      - COX-2 selective vs non-selective classification
      - Individual NSAID type identification
      - Cardiovascular risk stratification
      - High-dose identification for safety monitoring
      - Topical vs oral route differentiation

    columns:
      - name: person_id
        description: "Unique person identifier across the HEI system"
        tests:
          - not_null

      - name: medication_order_id
        description: "Unique identifier for the medication order record"
        tests:
          - not_null
          - unique

      - name: nsaid_type
        description: "NSAID classification by selectivity and route"
        tests:
          - not_null
          - accepted_values:
              values: ['COX2_SELECTIVE', 'TOPICAL', 'NON_SELECTIVE', 'OTHER_NSAID']

      - name: specific_nsaid
        description: "Specific NSAID medication type"
        tests:
          - not_null
          - accepted_values:
              values: ['IBUPROFEN', 'DICLOFENAC', 'NAPROXEN', 'ASPIRIN', 'CELECOXIB', 'ETORICOXIB', 'INDOMETACIN', 'MELOXICAM', 'OTHER_NSAID']

      - name: is_ibuprofen
        description: "Boolean flag indicating ibuprofen use (most common NSAID)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_diclofenac
        description: "Boolean flag indicating diclofenac use"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_naproxen
        description: "Boolean flag indicating naproxen use"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_cox2_selective
        description: "Boolean flag indicating COX-2 selective NSAID"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_topical
        description: "Boolean flag indicating topical NSAID formulation"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_non_selective
        description: "Boolean flag indicating non-selective NSAID"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_high_dose_ibuprofen
        description: "Boolean flag indicating high-dose ibuprofen (â‰¥2400mg daily)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_high_cv_risk
        description: "Boolean flag indicating NSAID with high cardiovascular risk"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - medication_order_id
      - bnf_codes_exist:
          bnf_codes: "1001"
