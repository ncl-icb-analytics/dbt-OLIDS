version: 2

models:
  - name: int_antidepressant_medications_all
    description: |
      All antidepressant medication orders for mental health conditions.
      Uses BNF classification (4.3) for antidepressant drugs.
      Includes ALL persons (active, inactive, deceased) following intermediate layer principles.
      
      Clinical Purpose:
      - Depression and anxiety disorder treatment
      - Chronic pain management (neuropathic pain)
      - Obsessive-compulsive disorder treatment
      - Post-traumatic stress disorder treatment
      
      Key Features:
      - Antidepressant class identification (SSRI, SNRI, tricyclic, MAOI)
      - Individual antidepressant type identification
      - First-line therapy identification (NICE guidance)
      - Long-term therapy tracking for monitoring
    
    columns:
      - name: person_id
        description: "Unique person identifier across the HEI system"
        tests:
          - not_null
          
      - name: medication_order_id
        description: "Unique identifier for the medication order record"
        tests:
          - not_null
          - unique
          
      - name: antidepressant_class
        description: "Antidepressant drug class classification"
        tests:
          - not_null
          - accepted_values:
              values: ['TRICYCLIC', 'MAOI', 'SSRI', 'OTHER_ANTIDEPRESSANTS', 'UNKNOWN_ANTIDEPRESSANT']
              
      - name: specific_antidepressant
        description: "Specific antidepressant medication type"
        tests:
          - not_null
          - accepted_values:
              values: ['CITALOPRAM', 'ESCITALOPRAM', 'FLUOXETINE', 'PAROXETINE', 'SERTRALINE', 'VENLAFAXINE', 'DULOXETINE', 'MIRTAZAPINE', 'AMITRIPTYLINE', 'DOSULEPIN', 'NORTRIPTYLINE', 'OTHER_ANTIDEPRESSANT']
              
      - name: is_citalopram
        description: "Boolean flag indicating citalopram use"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_sertraline
        description: "Boolean flag indicating sertraline use"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_fluoxetine
        description: "Boolean flag indicating fluoxetine use"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_ssri
        description: "Boolean flag indicating SSRI class antidepressant"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_tricyclic
        description: "Boolean flag indicating tricyclic antidepressant"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_snri
        description: "Boolean flag indicating SNRI class antidepressant"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_first_line
        description: "Boolean flag indicating first-line antidepressant (NICE guidance)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - medication_order_id
      - bnf_codes_exist:
          bnf_codes: "0403" 