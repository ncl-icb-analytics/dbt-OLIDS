version: 2
models:
- name: int_ppi_medications_all
  description: 'Intermediate: PPI Medication Orders - All recorded proton pump inhibitor prescriptions.


    Clinical Purpose:

    • Tracks PPI therapy for gastric acid suppression and ulcer prevention

    • Supports gastrointestinal medication management and safety monitoring

    • Enables analysis of long-term PPI usage and dosing patterns


    Data Granularity:

    • One row per medication order

    • Includes all patients regardless of status (active/inactive/deceased)

    • Historical data maintained for longitudinal analysis


    Key Features:

    • Specific PPI identification (omeprazole, lansoprazole, esomeprazole, etc.)

    • Dose categorisation for therapeutic indication assessment

    • H. pylori eradication therapy identification

    • Long-term therapy flags for medication review and deprescribing'
  columns:
  - name: person_id
    description: Unique person identifier across the HEI system
    tests:
    - not_null
  - name: medication_order_id
    description: Unique identifier for the medication order record
    tests:
    - not_null
    - unique
  - name: ppi_type
    description: Specific PPI medication type
    tests:
    - not_null
    - accepted_values:
        values:
        - ESOMEPRAZOLE
        - H_PYLORI_ERADICATION
        - LANSOPRAZOLE
        - OMEPRAZOLE
        - PANTOPRAZOLE
        - RABEPRAZOLE
        - OTHER_PPI
  - name: is_omeprazole
    description: Boolean flag indicating omeprazole use (most common PPI)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_lansoprazole
    description: Boolean flag indicating lansoprazole use
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_esomeprazole
    description: Boolean flag indicating esomeprazole use
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_h_pylori_eradication
    description: Boolean flag indicating H. pylori eradication therapy
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_high_dose
    description: Boolean flag indicating high-dose PPI therapy
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_standard_dose
    description: Boolean flag indicating standard-dose PPI therapy
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_long_term_therapy
    description: Boolean flag indicating long-term PPI therapy (>8 weeks)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - person_id
      - medication_order_id
  - bnf_codes_exist:
      bnf_codes: '0103050'
