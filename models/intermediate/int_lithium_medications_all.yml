version: 2

models:
  - name: int_lithium_medications_all
    description: |
      All lithium medication orders for bipolar disorder and severe depression.
      Uses BNF classification (4.2.3) for lithium.
      Includes ALL persons (active, inactive, deceased) following intermediate layer principles.
      
      Clinical Purpose:
      - Bipolar disorder mood stabilisation
      - Treatment-resistant depression augmentation
      - Prophylaxis of recurrent depression or mania
      
      Key Features:
      - Brand identification (critical for bioequivalence)
      - Dose categorisation for therapeutic monitoring
      - Formulation type tracking
      - Mandatory monitoring requirement flagging
      
      Safety Considerations:
      - Narrow therapeutic index requiring regular blood level monitoring
      - Brand switching contraindicated without careful monitoring
      - Requires renal function and thyroid monitoring
    
    columns:
      - name: person_id
        description: "Unique person identifier across the HEI system"
        tests:
          - not_null
          
      - name: medication_order_id
        description: "Unique identifier for the medication order record"
        tests:
          - not_null
          - unique
          
      - name: lithium_type
        description: "Lithium preparation type (carbonate vs citrate)"
        tests:
          - not_null
          - accepted_values:
              values: ['LITHIUM_CARBONATE', 'LITHIUM_CITRATE', 'OTHER_LITHIUM']
              
      - name: lithium_brand
        description: "Lithium brand name (critical for bioequivalence)"
        tests:
          - not_null
          - accepted_values:
              values: ['PRIADEL', 'CAMCOLIT', 'LISKONUM', 'LI_LIQUID', 'OTHER_BRAND']
              
      - name: is_lithium_carbonate
        description: "Boolean flag indicating lithium carbonate preparation"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_priadel
        description: "Boolean flag indicating Priadel brand (most common)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: lithium_dose_category
        description: "Lithium dose classification for therapeutic monitoring"
        tests:
          - not_null
          - accepted_values:
              values: ['STANDARD_DOSE', 'HIGH_DOSE', 'LOW_DOSE', 'UNKNOWN_DOSE']
              
      - name: formulation_type
        description: "Lithium formulation type"
        tests:
          - not_null
          - accepted_values:
              values: ['TABLET', 'CAPSULE', 'LIQUID', 'UNKNOWN_FORMULATION']
              
      - name: requires_monitoring
        description: "Boolean flag indicating monitoring requirement (always true for lithium)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - medication_order_id
      - bnf_codes_exist:
          bnf_codes: "040205" 