version: 2

models:
  - name: int_creatinine_all
    description: |
      All serum creatinine measurements from observations.
      Simple pattern using CRE_COD with clinical validation and reference ranges.
      Includes ALL persons following intermediate layer principles.
    tests:
      - cluster_ids_exist:
          cluster_ids: "CRE_COD"
    columns:
      - name: person_id
        description: "Unique person identifier"
        tests:
          - not_null
      - name: observation_id
        description: "Unique observation identifier"
        tests:
          - not_null
      - name: clinical_effective_date
        description: "Date of the creatinine measurement"
        tests:
          - not_null
      - name: creatinine_value
        description: "Serum creatinine value in µmol/L"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 10
              max_value: 1500
              severity: warn
      - name: is_valid_creatinine
        description: "Flag indicating if creatinine is within valid range (20-1000)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: creatinine_category
        description: "Clinical creatinine category"
        tests:
          - not_null
          - accepted_values:
              values: ['Invalid', 'Normal', 'Mildly Elevated', 'Moderately Elevated', 'Severely Elevated', 'Unknown']
      - name: is_elevated_creatinine
        description: "Flag indicating creatinine > 120 µmol/L"
        tests:
          - not_null
          - accepted_values:
              values: [true, false] 