version: 2

models:
  - name: int_waist_circumference_all

    tests:
      - test_cluster_ids_exist:
          cluster_ids: "WAIST_COD"
    description: |
      All waist circumference measurements from observations.
      Simple pattern using WAIST_COD with clinical validation and risk categorisation.
      Includes ALL persons following intermediate layer principles.
    columns:
      - name: person_id
        description: "Unique person identifier"
        tests:
          - not_null
      - name: observation_id
        description: "Unique observation identifier"
        tests:
          - not_null
      - name: clinical_effective_date
        description: "Date of the waist circumference measurement"
        tests:
          - not_null
      - name: waist_circumference_value
        description: "Waist circumference value in cm"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 20
              max_value: 300
              severity: warn
      - name: is_valid_waist_circumference
        description: "Flag indicating if waist circumference is within valid range (30-250)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: waist_risk_category
        description: "Clinical waist circumference risk category"
        tests:
          - not_null
          - accepted_values:
              values: ['Invalid', 'Low Risk', 'Moderate Risk (Female)', 'Moderate Risk', 'High Risk', 'Very High Risk', 'Unknown']
      - name: is_high_waist_risk
        description: "Flag indicating waist circumference ≥88cm"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: is_very_high_waist_risk
        description: "Flag indicating waist circumference ≥102cm"
        tests:
          - not_null
          - accepted_values:
              values: [true, false] 