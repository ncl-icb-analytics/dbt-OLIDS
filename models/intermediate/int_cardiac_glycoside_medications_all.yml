version: 2

models:
  - name: int_cardiac_glycoside_medications_all
    description: |
      All cardiac glycoside medication orders for heart failure and arrhythmias.
      Uses BNF classification (2.1.1) for cardiac glycosides.
      Includes ALL persons (active, inactive, deceased) following intermediate layer principles.
      
      Clinical Purpose:
      - Heart failure with reduced ejection fraction (symptomatic improvement)
      - Atrial fibrillation rate control
      - Arrhythmia management
      
      Key Features:
      - Digoxin dose categorisation for monitoring
      - Clinical indication inference from dose patterns
      - Elderly/renal dose identification
      - Requires therapeutic drug monitoring (TDM)
    
    columns:
      - name: person_id
        description: "Unique person identifier across the HEI system"
        tests:
          - not_null
          
      - name: medication_order_id
        description: "Unique identifier for the medication order record"
        tests:
          - not_null
          - unique
          
      - name: cardiac_glycoside_type
        description: "Specific cardiac glycoside medication type"
        tests:
          - not_null
          - accepted_values:
              values: ['DIGOXIN', 'DIGITOXIN', 'OTHER_CARDIAC_GLYCOSIDE']
              
      - name: is_digoxin
        description: "Boolean flag indicating digoxin use (most common cardiac glycoside)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: digoxin_dose_category
        description: "Digoxin dose classification for therapeutic monitoring"
        tests:
          - not_null
          - accepted_values:
              values: ['STANDARD_DOSE', 'HIGH_DOSE', 'LOW_DOSE', 'UNKNOWN_DOSE']
              
      - name: is_heart_failure_dose
        description: "Boolean flag indicating typical heart failure dosing"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_arrhythmia_dose
        description: "Boolean flag indicating higher dose for arrhythmia control"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
              
      - name: is_elderly_renal_dose
        description: "Boolean flag indicating reduced dose for elderly or renal impairment"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

    tests:
      - bnf_codes_exist:
          bnf_codes: "020101"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - medication_order_id
      - bnf_codes_exist:
          bnf_codes: "020101" 