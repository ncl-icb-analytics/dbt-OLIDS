version: 2
models:
- name: int_dxa_scans_all
  tests:
  - cluster_ids_exist:
      cluster_ids: DXA2_COD, DXA_COD
  description: 'Intermediate: DXA Scan Observations - All recorded DXA scan procedures and T-score measurements.


    Clinical Purpose:

    • Tracks DXA scans for osteoporosis diagnosis and bone health monitoring

    • Supports osteoporosis register eligibility and fracture risk assessment

    • Enables bone density monitoring and treatment response evaluation


    Data Granularity:

    • One row per DXA observation (procedures and T-score measurements)

    • Includes all patients regardless of status (active/inactive/deceased)

    • Uses DXA_COD (procedures) and DXA2_COD (T-scores) clusters


    Key Features:

    • DXA scan procedure identification and T-score measurement validation

    • Clinical T-score interpretation (osteoporosis, osteopenia, normal)

    • QOF osteoporosis confirmation flags (T-score ≤ -2.5)

    • Comprehensive bone health assessment for clinical decision support'

  columns:
  - name: person_id
    description: Unique person identifier

    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier

    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the DXA scan observation

    tests:
    - not_null
  - name: concept_code
    description: SNOMED concept code for DXA observation

    tests:
    - not_null
  - name: concept_display
    description: Description of the DXA code

    tests:
    - not_null
  - name: source_cluster_id
    description: QOF cluster ID for DXA pathway

    tests:
    - not_null
    - accepted_values:

        values:
        - DXA_COD
        - DXA2_COD
  - name: numeric_value
    description: Raw numeric value from observation (T-score for DXA2_COD)
  - name: is_dxa_scan_procedure
    description: Flag indicating DXA scan procedure (DXA_COD)

    tests:
    - not_null
    - accepted_values:

        values:
        - true
        - false
  - name: is_dxa_t_score_measurement
    description: Flag indicating DXA T-score measurement (DXA2_COD)

    tests:
    - not_null
    - accepted_values:

        values:
        - true
        - false
  - name: validated_t_score
    description: Clinically validated T-score (range -6.0 to 6.0)

    tests:
    - dbt_utils.accepted_range:
        min_value: -6.0
        max_value: 6.0
        severity: warn
  - name: t_score_interpretation
    description: Clinical interpretation of T-score

    tests:
    - accepted_values:

        values:
        - Normal
        - Osteopenia
        - Osteoporosis
  - name: confirms_osteoporosis_diagnosis
    description: Flag indicating T-score confirms osteoporosis (≤ -2.5)

    tests:
    - not_null
    - accepted_values:

        values:
        - true
        - false
