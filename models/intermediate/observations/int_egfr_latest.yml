version: 2

models:
  - name: int_egfr_latest
    description: |
      Latest valid eGFR measurement per person.
      Filters to most recent valid eGFR (1-200 range).
    columns:
      - name: person_id
        description: "Unique person identifier"
        tests:
          - not_null
          - unique
      - name: clinical_effective_date
        description: "Date of the eGFR measurement"
        tests:
          - not_null
      - name: egfr_value
        description: "eGFR value in mL/min/1.73m² (valid range only)"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 200
      - name: ckd_stage
        description: "CKD stage classification (excludes 'Invalid')"
        tests:
          - not_null
          - accepted_values:
              values: ['Normal/High (≥90)', 'Mild decrease (60-89)', 'CKD Stage 3a (45-59)', 'CKD Stage 3b (30-44)', 'CKD Stage 4 (15-29)', 'CKD Stage 5 (<15)']
      - name: is_ckd_indicator
        description: "Flag indicating eGFR < 60 (suggests CKD)"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
