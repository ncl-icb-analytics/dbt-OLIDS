version: 2
models:
- name: int_dementia_diagnoses_all
  tests:
  - test_cluster_ids_exist:
      cluster_ids: DEMRES_COD, DEM_COD
  description: 'All dementia diagnosis observations from clinical records using QOF cluster IDs.

    Provides comprehensive data collection for dementia register and cognitive health monitoring.


    QOF Cluster IDs Used:

    - DEM_COD: Dementia diagnoses


    Clinical Purpose:

    - QOF dementia register data collection (presence of DEM_COD)

    - Dementia care pathway monitoring

    - Cognitive health assessment support

    - Memory service referral tracking


    Key QOF Requirements:

    - Register inclusion: Presence of any dementia diagnosis code (DEM_COD)

    - No age restrictions for dementia register

    - No resolution codes - dementia is considered permanent condition

    - Focus on early detection and ongoing care


    Note: Dementia does not have resolved codes as it is considered a permanent condition.

    The register is based purely on the presence of diagnostic codes.


    Includes ALL persons following intermediate layer principles.

    Use as input for fct_person_dementia_register.sql which applies QOF business rules.

    '
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier
    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the dementia diagnosis observation
    tests:
    - not_null
  - name: concept_code
    description: SNOMED concept code for dementia diagnosis
    tests:
    - not_null
  - name: concept_display
    description: Description of the dementia diagnosis code
    tests:
    - not_null
  - name: source_cluster_id
    description: QOF cluster ID (DEM_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - DEM_COD
  - name: is_dementia_diagnosis_code
    description: Flag indicating dementia diagnosis (DEM_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: earliest_dementia_date
    description: Earliest dementia diagnosis date for this person
  - name: latest_dementia_date
    description: Latest dementia diagnosis date for this person
  - name: dementia_observation_type
    description: Classification of this specific observation (Dementia Diagnosis, Unknown)
    tests:
    - not_null
    - accepted_values:
        values:
        - Dementia Diagnosis
        - Unknown
  - name: all_dementia_concept_codes
    description: Array of all dementia diagnosis concept codes for this person
  - name: all_dementia_concept_displays
    description: Array of all dementia diagnosis concept displays for this person
