CREATE OR REPLACE DYNAMIC TABLE DATA_LAB_NCL_TRAINING_TEMP.HEI_MIGRATION.INTERMEDIATE_LTC_LCS_CF_BASE_POPULATION (
    PERSON_ID,
    SK_PATIENT_ID,
    CONDITION_CODE,
    IS_ON_REGISTER
)
COMMENT = 'Reusable base population for LTC LCS case finding indicators. Excludes patients already in LTC programmes.'
TARGET_LAG = '4 hours'
REFRESH_MODE = AUTO
INITIALIZE = ON_CREATE
WAREHOUSE = NCL_ANALYTICS_XS
AS
SELECT DISTINCT
    PERSON_ID,
    SK_PATIENT_ID,
    CONDITION_CODE,
    IS_ON_REGISTER
FROM DATA_LAB_NCL_TRAINING_TEMP.HEI_MIGRATION.FCT_PERSON_LTC_SUMMARY
WHERE PERSON_ID NOT IN (
    -- Exclude patients already in LTC programmes
    SELECT PERSON_ID 
    FROM DATA_LAB_NCL_TRAINING_TEMP.HEI_MIGRATION.DIM_PROG_LTC_LCS_CF_EXCLUSIONS
); 