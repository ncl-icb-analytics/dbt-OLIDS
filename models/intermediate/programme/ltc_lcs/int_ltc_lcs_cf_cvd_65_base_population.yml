version: 2

models:
  - name: int_ltc_lcs_cf_cvd_65_base_population
    description: "CVD_65 base population for moderate-dose statin case finding. Includes patients with QRISK2 ≥ 10 who are not on moderate-dose statins, have no statin allergies/contraindications, and no recent statin decisions."
    columns:
      - name: person_id
        description: "Unique patient identifier"
        tests:
          - not_null
          - unique
      - name: age
        description: "Patient age"
        tests:
          - not_null
      - name: latest_qrisk2_date
        description: "Date of latest QRISK2 ≥ 10 assessment"
        tests:
          - not_null
      - name: latest_qrisk2_value
        description: "Latest QRISK2 value (≥ 10)"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 10
      - name: has_moderate_dose_statin
        description: "Whether patient has moderate-dose statin in last 12 months (should be FALSE for all)"
        tests:
          - not_null
          - accepted_values:
              values: [false]
      - name: has_statin_allergy
        description: "Whether patient has statin allergy/contraindication (should be FALSE for all)"
        tests:
          - not_null
          - accepted_values:
              values: [false]
      - name: has_statin_decision
        description: "Whether patient has statin decision in last 60 months (should be FALSE for all)"
        tests:
          - not_null
          - accepted_values:
              values: [false]
      - name: latest_moderate_dose_statin_date
        description: "Latest moderate-dose statin date (should be NULL for all)"
      - name: latest_statin_allergy_date
        description: "Latest statin allergy/contraindication date (should be NULL for all)"
      - name: latest_statin_decision_date
        description: "Latest statin decision date (should be NULL for all)" 