version: 2

models:
  - name: int_ltc_lcs_ethnicity_observations
    description: "Intermediate model for ethnicity observations used in LTC/LCS diabetes case finding. Contains BAME, White British, and excluded ethnicity classifications."

    columns:
      - name: observation_id
        description: "Unique identifier for the observation"
        tests:
          - not_null

      - name: person_id
        description: "Unique identifier for the person"
        tests:
          - not_null

      - name: clinical_effective_date
        description: "Date when the ethnicity observation was recorded"

      - name: mapped_concept_code
        description: "Mapped concept code for the ethnicity classification"

      - name: mapped_concept_display
        description: "Human-readable description of the ethnicity classification"

      - name: cluster_id
        description: "Cluster identifier for the ethnicity type"
        tests:
          - accepted_values:
              values: ['ETHNICITY_BAME', 'ETHNICITY_WHITE_BRITISH', 'DIABETES_EXCLUDED_ETHNICITY']

      - name: cluster_description
        description: "Description of the ethnicity cluster"

    tests:
      - cluster_ids_exist:
          cluster_ids: "ETHNICITY_BAME,ETHNICITY_WHITE_BRITISH,DIABETES_EXCLUDED_ETHNICITY"
