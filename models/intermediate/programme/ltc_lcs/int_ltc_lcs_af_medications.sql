{{ config(
    post_hook=[
        "COMMENT ON TABLE {{ this }} IS 'Intermediate: LTC LCS AF Medications - Collects all atrial fibrillation-relevant medications for Long Term Conditions case finding measures.

Clinical Purpose:
â€¢ Gathers comprehensive AF-related medication data for case finding algorithms
â€¢ Supports identification of patients with undiagnosed atrial fibrillation through medication patterns
â€¢ Enables medication-based risk stratification for AF case finding measures
â€¢ Provides foundation data for AF_61 and AF_62 case finding indicators

Data Granularity:
â€¢ One row per medication order for AF-relevant medications
â€¢ Covers oral anticoagulants, AF medications, digoxin, and cardiac glycosides
â€¢ Sourced from LTC_LCS programme medication clusters
â€¢ Includes all historical and current AF medication patterns

Key Features:
â€¢ Cluster IDs: ORAL_ANTICOAGULANT_2_8_2, AF_MEDICATIONS, DIGOXIN_MEDICATIONS, CARDIAC_GLYCOSIDES
â€¢ Supports both AF_61 and AF_62 case finding measure requirements
â€¢ Comprehensive medication pattern analysis for undiagnosed AF detection
â€¢ Integration with LTC_LCS programme medication tracking systems

ðŸ¤– Generated by dbt. This table is managed by dbt - for model definitions and documentation, see https://github.com/ncl-icb-analytics/snowflake-hei-migration'"
    ]
) }}

-- Intermediate model for LTC LCS AF Medications
-- Collects all AF-relevant medications needed for all AF case finding measures

-- Use the macro to fetch all medication orders for AF clusters
-- (Add or adjust cluster_ids as needed for all AF-relevant meds)

{{ get_medication_orders(
    cluster_id="'ORAL_ANTICOAGULANT_2_8_2','AF_MEDICATIONS','DIGOXIN_MEDICATIONS','CARDIAC_GLYCOSIDES'",
    source="LTC_LCS"
) }}
