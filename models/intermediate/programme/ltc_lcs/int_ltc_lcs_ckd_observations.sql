{{ config(
    post_hook=[
        "COMMENT ON TABLE {{ this }} IS 'Intermediate: LTC LCS CKD Observations - Collects all chronic kidney disease-relevant observations for Long Term Conditions case finding measures.

Clinical Purpose:
â€¢ Gathers comprehensive CKD-related clinical observation data for case finding algorithms
â€¢ Supports identification of patients with undiagnosed chronic kidney disease through laboratory and clinical observations
â€¢ Enables observation-based risk stratification for CKD case finding measures CKD_61 and CKD_62
â€¢ Provides foundation data for CKD case finding indicators including consecutive low eGFR readings

Data Granularity:
â€¢ One row per clinical observation for CKD-relevant observations
â€¢ Covers urine ACR testing, eGFR testing, acute kidney injury, BPH/gout, haematuria, proteinuria
â€¢ Includes medication-related observations: lithium, sulfasalazine, tacrolimus
â€¢ Sourced from LTC_LCS programme observation clusters

Key Features:
â€¢ Cluster IDs: UACR_TESTING, EGFR_TESTING, CKD_ACUTE_KIDNEY_INJURY, CKD_BPH_GOUT, HAEMATURIA, LITHIUM_MEDICATIONS, SULFASALAZINE_MEDICATIONS, TACROLIMUS_MEDICATIONS, URINE_BLOOD_NEGATIVE, PROTEINURIA_FINDINGS
â€¢ Supports CKD_61 (consecutive low eGFR) and CKD_62 (elevated ACR) case finding measures
â€¢ Comprehensive laboratory and clinical observation analysis for undiagnosed CKD detection
â€¢ Integration with LTC_LCS programme clinical observation tracking systems

ðŸ¤– Generated by dbt. This table is managed by dbt - for model definitions and documentation, see https://github.com/ncl-icb-analytics/dbt-olids'"
    ]
) }}

-- Intermediate model for LTC LCS CKD Observations
-- Collects all CKD-relevant observations needed for CKD case finding measures

-- This intermediate fetches all CKD-relevant observations for case finding
-- Includes:
-- - URINE_ACR for CKD_61 and CKD_62 (urine ACR tests)
-- - EGFR_COD_LCS for CKD_61 (eGFR tests for consecutive low readings)
-- - Additional CKD-related observations for other case finding measures
{{ get_observations(
    cluster_ids="'UACR_TESTING', 'EGFR_TESTING', 'CKD_ACUTE_KIDNEY_INJURY', 'CKD_BPH_GOUT', 'HAEMATURIA', 'LITHIUM_MEDICATIONS', 'SULFASALAZINE_MEDICATIONS', 'TACROLIMUS_MEDICATIONS', 'URINE_BLOOD_NEGATIVE', 'PROTEINURIA_FINDINGS'",
    source='LTC_LCS'
) }}
