version: 2
models:
- name: int_bmi_qof
  tests:
  - test_cluster_ids_exist:
      cluster_ids: BMI30_COD, BMIVAL_COD
  description: 'QOF-specific BMI measurements with obesity register business logic.

    Follows the legacy intermediate_bmi_values.sql patterns with age validation

    and QOF obesity register rules. Includes ALL persons following intermediate layer principles.

    '
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier
    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the BMI measurement
    tests:
    - not_null
  - name: bmi_value
    description: "BMI value in kg/m\xB2"
    tests:
    - not_null
    - dbt_utils.accepted_range:
        min_value: 5
        max_value: 150
        severity: warn
  - name: original_result_value
    description: Original BMI value as recorded
    tests:
    - not_null
  - name: is_valid_bmi
    description: Flag indicating if BMI is within valid range (10-80)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
