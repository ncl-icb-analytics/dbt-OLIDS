version: 2
models:
- name: int_depression_diagnoses_all
  tests:
  - cluster_ids_exist:
      cluster_ids: DEPRES_COD, DEP_COD
  description: "All depression diagnosis and care pathway observations from clinical records using QOF cluster IDs.\nProvides\
    \ comprehensive data collection for depression register and care monitoring.\n\nQOF Cluster IDs Used:\n- DEPR_COD: Depression\
    \ diagnoses\n- DEPRES_COD: Depression resolved/remission codes\n- DEPRVW_COD: Depression review codes (QOF timing: 10-56\
    \ days post-diagnosis)\n- DEPRINVITE_COD: Depression invite codes\n- DEPRPCADEC_COD: Depression PCA decline codes  \n\
    - DEPRPCAPU_COD: Depression PCA unsuitable codes\n\nClinical Purpose:\n- QOF depression register data collection (aged\
    \ 18+, unresolved episode since 1 April 2006)\n- Depression care pathway monitoring\n- Review and invitation tracking\
    \  \n- Resolution status monitoring\n\nKey QOF Requirements:\n- Register inclusion: Age \u226518, latest unresolved episode\
    \ since 1 April 2006\n- Recent episode tracking (12, 15, 24 months)\n- Review timing validation (10-56 days post-diagnosis)\n\
    \nIncludes ALL persons following intermediate layer principles.\nUse as input for fct_person_depression_register.sql which\
    \ applies QOF business rules.\n"
  columns:
  - name: person_id
    description: Unique person identifier
    tests:
    - not_null
  - name: observation_id
    description: Unique observation identifier
    tests:
    - not_null
  - name: clinical_effective_date
    description: Date of the depression-related observation
    tests:
    - not_null
  - name: concept_code
    description: SNOMED concept code for depression-related observation
    tests:
    - not_null
  - name: concept_display
    description: Description of the depression-related code
    tests:
    - not_null
  - name: source_cluster_id
    description: QOF cluster ID for depression care pathway
    tests:
    - not_null
    - accepted_values:
        values:
        - DEPR_COD
        - DEPRES_COD
        - DEPRVW_COD
        - DEPRINVITE_COD
        - DEPRPCADEC_COD
        - DEPRPCAPU_COD
  - name: is_depression_diagnosis_code
    description: Flag indicating depression diagnosis (DEPR_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: is_depression_resolved_code
    description: Flag indicating depression resolved/remission (DEPRES_COD)
    tests:
    - not_null
    - accepted_values:
        values:
        - true
        - false
  - name: earliest_depression_date
    description: Earliest depression diagnosis date for this person
  - name: latest_depression_date
    description: Latest depression diagnosis date for this person
  - name: earliest_resolved_date
    description: Earliest depression resolved date for this person
  - name: latest_resolved_date
    description: Latest depression resolved date for this person
  - name: earliest_review_date
    description: Earliest depression review date for this person
  - name: latest_review_date
    description: Latest depression review date for this person
  - name: earliest_invite_date
    description: Earliest depression invite date for this person
  - name: latest_invite_date
    description: Latest depression invite date for this person
  - name: earliest_pca_decline_date
    description: Earliest depression PCA decline date for this person
  - name: latest_pca_decline_date
    description: Latest depression PCA decline date for this person
  - name: earliest_pca_unsuitable_date
    description: Earliest depression PCA unsuitable date for this person
  - name: latest_pca_unsuitable_date
    description: Latest depression PCA unsuitable date for this person
  - name: depression_observation_type
    description: Classification of this specific observation
    tests:
    - not_null
    - accepted_values:
        values:
        - Depression Diagnosis
        - Depression Resolved
        - Depression Review
        - Depression Invite
        - Depression PCA Decline
        - Depression PCA Unsuitable
        - Unknown
  - name: all_depression_concept_codes
    description: Array of all depression diagnosis concept codes for this person
  - name: all_depression_concept_displays
    description: Array of all depression diagnosis concept displays for this person
  - name: all_resolved_concept_codes
    description: Array of all depression resolved concept codes for this person
  - name: all_review_concept_codes
    description: Array of all depression review concept codes for this person
  - name: all_invite_concept_codes
    description: Array of all depression invite concept codes for this person
  - name: all_pca_decline_concept_codes
    description: Array of all depression PCA decline concept codes for this person
  - name: all_pca_unsuitable_concept_codes
    description: Array of all depression PCA unsuitable concept codes for this person
