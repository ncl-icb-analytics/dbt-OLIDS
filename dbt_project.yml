name: 'dbt_olids'
version: '1.0'
config-version: 2

profile: 'dbt_olids'

target-path: "target"
clean-targets:
  - "target"
  - "dbt_packages"

model-paths: ["models"]
analysis-paths: ["analysis"]

# Configure dbt audit schema naming
vars:
  dbt_audit_schema: "test_audit"  # Cleaner name instead of dbt_dbt_test_audit
  
  # Flu campaign configuration - Change these values to run for different campaign years
  flu_current_campaign: "flu_2025_26"     # Current flu campaign (flu_2023_24, flu_2024_25, flu_2025_26)
  flu_previous_campaign: "flu_2024_25"    # Previous flu campaign (for year-over-year comparison)
  flu_audit_end_date: "CURRENT_DATE"      # Default audit end date

  # COVID campaign configuration - Change these values to run for different campaign years  
  covid_current_campaign: "covid_2025_autumn"   # Current COVID campaign
  covid_previous_campaign: "covid_2024_autumn"  # Previous COVID campaign (for year-over-year comparison)
  covid_audit_end_date: "2025-06-30"            # End of spring 2025 campaign (last completed campaign)

# Configure test failure storage (only for failures)
# Note: This creates tables for all tests, populated only on failure
# Consider removing if too many empty tables are created
tests:
  +store_failures: false  # Disabled by default to avoid clutter
  +schema: "test_audit"

models:
  dbt_olids:
    +materialized: table
    +database: "{{ env_var('SNOWFLAKE_TARGET_DATABASE') }}"
    +persist_docs:
      columns: true
    olids:
      staging:
        +materialized: view
        +post-hook: ["{{ add_model_comment() }}"]
        +tags: ["staging"]
      intermediate:
        +materialized: table
        +post-hook: ["{{ add_model_comment() }}"]
        +tags: ["intermediate"]
      marts:
        +materialized: table
        +post-hook: ["{{ add_model_comment() }}"]
        +tags: ["marts"]
    
    shared:
      staging:
        +materialized: view
        +post-hook: ["{{ add_model_comment() }}"]
        +tags: ["staging"]

